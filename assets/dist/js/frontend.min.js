(function(){jQuery(document).ready(function(e){if(typeof e(".paghiper_tax_id").mask=="function"){let a=function(){var n=function(i){return i.replace(/\D/g,"").length>11?"00.000.000/0000-00":"000.000.000-009"};e(".paghiper_tax_id").mask(n,{clearIfNotMatch:!0,placeholder:"___.___.___-__",onKeyPress:function(i,s,c,u){c.mask(n.apply({},arguments),u)}})};var t=a;e(document.body).on("updated_checkout",function(n){a()}),a()}e(document.body).on("updated_checkout",function(a){_()}),_()});function _(){let e=document.querySelectorAll('[name="billing_cpf"], [name="billing_cnpj"]'),t=document.querySelectorAll('[name="billing_first_name"], [name="billing_company"]'),a=document.querySelectorAll(".wc-paghiper-form");[].forEach.call(a,n=>{let i=n.querySelector(".paghiper-taxid-fieldset"),s=n.querySelector(".paghiper-payername-fieldset"),c=!1,u=!1;i&&(e.length>0?i.classList.add("paghiper-hidden"):(i.classList.remove("paghiper-hidden"),c=!0)),s&&(t.length>0?s.classList.add("paghiper-hidden"):(s.classList.remove("paghiper-hidden"),u=!0)),!c&&!u?n.classList.add("paghiper-hidden"):n.classList.remove("paghiper-hidden")})}window.copyPaghiperEmv=function(){let e=document.querySelector(".paghiper-pix-code"),t=e.querySelector("textarea"),a=e.querySelector("button");t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value),a.dataset.originalText=a.innerHTML,a.innerHTML="Copiado!",setTimeout(function(n){let i=n.dataset.originalText;n.innerHTML=i,document.getSelection().removeAllRanges()},2e3,a)};async function k(e){if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(e),!0}catch(n){console.error("Falha ao copiar com a API moderna: ",n)}const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();let a=!1;try{a=document.execCommand("copy")}catch(n){console.error("Erro ao tentar copiar com o método de fallback: ",n)}return document.body.removeChild(t),a}function p(e){const{message:t,type:a="info",duration:n=3e3,onDismiss:i}=e,s=document.getElementById("ph-reusable-notifications");if(!s)return null;const c=document.createElement("div");return c.className=`ph-notification ${a}`,c.innerHTML=t,s.appendChild(c),n>0&&setTimeout(()=>{document.body.contains(c)&&(c.classList.add("fade-out"),c.addEventListener("animationend",()=>{c.remove(),typeof i=="function"&&i()}))},n),c}async function h(){p({message:'<span class="ph-notification-spinner"></span> Por favor aguarde...',type:"warning",duration:5e3});try{const a=await(await fetch(window.location.href)).text(),s=new DOMParser().parseFromString(a,"text/html").querySelector(".ph-checkout-v2"),c=document.querySelector(".ph-checkout-v2");if(s&&c){c.innerHTML=s.innerHTML;const u=new Event("DOMContentLoaded",{bubbles:!0,cancelable:!1});document.dispatchEvent(u)}else window.location.reload()}catch(t){console.error("Falha ao atualizar o conteúdo do checkout:",t),window.location.reload()}}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".ph-checkout-v2__copy-code-button"),t=document.querySelector(".ph-checkout-v2__qr-container"),a=document.querySelector(".ph-checkout-v2__copy-code-container .textarea-container"),n=document.getElementById("ph-i-paid-button"),i=async()=>{var r;const o=(r=document.querySelector(".ph-checkout-v2__copy-code-container .digitable_line_container"))==null?void 0:r.textContent.trim();if(!o)return;if(await k(o)&&(ph_checkout_params!=null&&ph_checkout_params.is_pix?p({message:"Código PIX copiado com sucesso!",type:"success"}):p({message:"Código de barras copiado com sucesso!",type:"success"}),e)){const d=e.dataset.originalText||e.textContent;e.dataset.originalText||(e.dataset.originalText=d),e.textContent="Copiado!",setTimeout(()=>{e.textContent=d},2e3)}},s=o=>{const l=o.currentTarget.querySelector(".digitable_line_container");if(window.getSelection&&document.createRange){const r=window.getSelection(),d=document.createRange();d.selectNodeContents(l),r.removeAllRanges(),r.addRange(d)}};e&&e.addEventListener("click",i),t&&t.addEventListener("click",i),a&&a.addEventListener("click",s);const c=()=>{let o=null;const l=ph_checkout_params==null?void 0:ph_checkout_params.order_id,r=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!l||!r)return;const d=setInterval(()=>{if(f){n.disabled=!0,clearInterval(d),o&&document.body.contains(o)&&(o.remove(),o=null);return}if(!o||!document.body.contains(o)){const m='<span class="ph-notification-spinner"></span>';if(ph_checkout_params!=null&&ph_checkout_params.is_pix)o=p({message:`${m} Aguardando confirmação do pagamento...`,type:"info",duration:0});else{const y=["Agora é só pagar seu boleto e aguardar a confirmação!","Seu pagamento pode levar até 3 dias úteis para ser confirmado.","Assim que isso ocorrer, te avisaremos por aqui."];o=p({message:`${m} <span>${y[0]}</span>`,type:"info",duration:0});const x=o.querySelector("span:last-child");v(o,x,y,6e3,250,1e3)}}n&&(n.disabled=!0),jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_check_payment_status",security:r,order_id:l},function(m){n&&!f&&(n.disabled=!1),m.success?m.data.status==="paid"?(clearInterval(d),o&&o.remove(),p({message:"Pagamento confirmado com sucesso!",type:"success",duration:5e3}),setTimeout(()=>{h()},1e3)):m.data.status==="reserved"&&(clearInterval(d),o&&o.remove(),p({message:"Pagamento pré-confirmado! Agora é só esperar a compensação.",type:"success",duration:5e3}),setTimeout(()=>{h()},1e3)):console.error("Erro ao verificar status do pagamento:",m.data.message)}).fail(function(){n&&!f&&(n.disabled=!1)})},1e4)};document.querySelector('.ph-checkout-v2[data-status="pending"]')&&typeof ph_checkout_params<"u"&&c(),n&&n.addEventListener("click",()=>{b()});const u=document.getElementById("ph-restore-cart-button");u&&u.addEventListener("click",()=>{const o=ph_checkout_params==null?void 0:ph_checkout_params.order_id,l=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!o||!l)return;const r='<span class="ph-notification-spinner" style="border-top-color: #fff;"></span>',d=p({message:`${r} Restaurando seu carrinho...`,type:"info",duration:0});jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_restore_cart",security:l,order_id:o},function(m){m.success?(d&&(d.innerHTML=`${r} Redirecionando você para a tela de checkout...`),setTimeout(()=>{window.location.href=m.data.redirect_url},2e3)):(d&&d.remove(),p({message:"Ocorreu um erro ao tentar restaurar seu carrinho. Por favor, tente novamente.",type:"error"}))})})});let f=!1;function g(e){return new Promise(t=>setTimeout(t,e))}async function v(e,t,a,n,i,s){let c=0;const u=async()=>{if(!document.body.contains(e)||(await g(n),!document.body.contains(e)))return;const o=a[c];for(let r=o.length;r>=0;r--){if(!document.body.contains(e))return;t.textContent=o.substring(0,r),await g(i/o.length)}c=(c+1)%a.length;const l=a[c];for(let r=0;r<l.length;r++){if(!document.body.contains(e))return;t.textContent+=l[r],await g(s/l.length)}u()};u()}const b=()=>{if(f)return;f=!0;let e=document.querySelector(".ph-notification.info");e&&e.classList.add("fade-out");const t=document.getElementById("ph-i-paid-button");t&&(t.disabled=!0);const a=ph_checkout_params==null?void 0:ph_checkout_params.order_id,n=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!a||!n){f=!1,t&&(t.disabled=!1);return}const i='<span class="ph-notification-spinner"></span>',s=["Estamos confirmando seu pagamento, só um instante...","Às vezes o banco leva um tempinho para nos notificar.","Não se preocupe, vamos continuar verificando por aqui."],c=p({message:`${i} <span>${s[0]}</span>`,type:"warning",duration:0}),u=c.querySelector("span:last-child");v(c,u,s,6e3,250,1e3);const o=()=>{jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_check_payment_status",security:n,order_id:a},function(d){d.success&&d.data.status==="paid"&&(clearInterval(l),clearTimeout(r),c.remove(),p({message:"Pagamento confirmado!",type:"success"}),setTimeout(()=>{typeof h=="function"?h():window.location.reload()},1e3))})},l=setInterval(o,15e3),r=setTimeout(()=>{clearInterval(l),c.remove(),p({message:"Ainda não recebemos a confirmação do seu pagamento.",type:"error"}),f=!1,t&&(t.disabled=!1)},18e5);o()};
})();