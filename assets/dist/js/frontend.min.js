(function(){jQuery(document).ready(function(e){if(typeof e(".paghiper_tax_id").mask=="function"){let n=function(){var o=function(i){return i.replace(/\D/g,"").length>11?"00.000.000/0000-00":"000.000.000-009"};e(".paghiper_tax_id").mask(o,{clearIfNotMatch:!0,placeholder:"___.___.___-__",onKeyPress:function(i,r,s,u){s.mask(o.apply({},arguments),u)}})};var t=n;e(document.body).on("updated_checkout",function(o){n()}),n()}e(document.body).on("updated_checkout",function(n){_()}),_()});function _(){let e=document.querySelectorAll('[name="billing_cpf"], [name="billing_cnpj"]'),t=document.querySelectorAll('[name="billing_first_name"], [name="billing_company"]'),n=document.querySelectorAll(".wc-paghiper-form");[].forEach.call(n,o=>{let i=o.querySelector(".paghiper-taxid-fieldset"),r=o.querySelector(".paghiper-payername-fieldset"),s=!1,u=!1;i&&(e.length>0?i.classList.add("paghiper-hidden"):(i.classList.remove("paghiper-hidden"),s=!0)),r&&(t.length>0?r.classList.add("paghiper-hidden"):(r.classList.remove("paghiper-hidden"),u=!0)),!s&&!u?o.classList.add("paghiper-hidden"):o.classList.remove("paghiper-hidden")})}window.copyPaghiperEmv=function(){let e=document.querySelector(".paghiper-pix-code"),t=e.querySelector("textarea"),n=e.querySelector("button");t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value),n.dataset.originalText=n.innerHTML,n.innerHTML="Copiado!",setTimeout(function(o){let i=o.dataset.originalText;o.innerHTML=i,document.getSelection().removeAllRanges()},2e3,n)};async function k(e){if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(e),!0}catch(o){console.error("Falha ao copiar com a API moderna: ",o)}const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();let n=!1;try{n=document.execCommand("copy")}catch(o){console.error("Erro ao tentar copiar com o método de fallback: ",o)}return document.body.removeChild(t),n}function p(e){const{message:t,type:n="info",duration:o=3e3}=e,i=document.getElementById("ph-reusable-notifications");if(!i)return null;const r=document.createElement("div");return r.className=`ph-notification ${n}`,r.innerHTML=t,i.appendChild(r),o>0&&setTimeout(()=>{r.classList.add("fade-out"),r.addEventListener("animationend",()=>{r.remove()})},o),r}async function h(){p({message:'<span class="ph-notification-spinner"></span> Por favor aguarde...',type:"warning",duration:5e3});try{const n=await(await fetch(window.location.href)).text(),r=new DOMParser().parseFromString(n,"text/html").querySelector(".ph-checkout-v2"),s=document.querySelector(".ph-checkout-v2");r&&s?s.innerHTML=r.innerHTML:window.location.reload()}catch(t){console.error("Falha ao atualizar o conteúdo do checkout:",t),window.location.reload()}}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".ph-checkout-v2__copy-code-button"),t=document.querySelector(".ph-checkout-v2__qr-container"),n=document.querySelector(".ph-checkout-v2__copy-code-container .textarea-container"),o=async()=>{var c;const a=(c=document.querySelector(".ph-checkout-v2__copy-code-container .digitable_line_container"))==null?void 0:c.textContent.trim();if(!a)return;if(await k(a)&&(ph_checkout_params!=null&&ph_checkout_params.is_pix?p({message:"Código PIX copiado com sucesso!",type:"success"}):p({message:"Código de barras copiado com sucesso!",type:"success"}),e)){const l=e.dataset.originalText||e.textContent;e.dataset.originalText||(e.dataset.originalText=l),e.textContent="Copiado!",setTimeout(()=>{e.textContent=l},2e3)}},i=a=>{const d=a.currentTarget.querySelector(".digitable_line_container");if(window.getSelection&&document.createRange){const c=window.getSelection(),l=document.createRange();l.selectNodeContents(d),c.removeAllRanges(),c.addRange(l)}};e&&e.addEventListener("click",o),t&&t.addEventListener("click",o),n&&n.addEventListener("click",i);const r=()=>{let a=null;const d=ph_checkout_params==null?void 0:ph_checkout_params.order_id,c=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!d||!c)return;const l=setInterval(()=>{if(!a||!document.body.contains(a)){const m='<span class="ph-notification-spinner"></span>';if(ph_checkout_params!=null&&ph_checkout_params.is_pix)a=p({message:`${m} Aguardando confirmação do pagamento...`,type:"info",duration:0});else{const y=["Agora é só pagar seu boleto e aguardar a confirmação!","Seu pagamento pode levar até 3 dias úteis para ser confirmado.","Assim que isso ocorrer, te avisaremos por aqui."];a=p({message:`${m} <span>${y[0]}</span>`,type:"info",duration:0});const x=a.querySelector("span:last-child");v(a,x,y,6e3,250,1e3)}}jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_check_payment_status",security:c,order_id:d},function(m){m.success?m.data.status==="paid"?(clearInterval(l),a&&a.remove(),p({message:"Pagamento confirmado com sucesso!",type:"success",duration:5e3}),setTimeout(()=>{h()},1e3)):m.data.status==="reserved"&&(clearInterval(l),a&&a.remove(),p({message:"Pagamento pré-confirmado! Agora é só esperar a compensação.",type:"success",duration:5e3}),setTimeout(()=>{h()},1e3)):(clearInterval(l),console.error("Erro ao verificar status do pagamento:",m.data.message))})},1e4)};document.querySelector('.ph-checkout-v2[data-status="pending"]')&&typeof ph_checkout_params<"u"&&r();const s=document.getElementById("ph-i-paid-button");s&&s.addEventListener("click",()=>{T()});const u=document.getElementById("ph-restore-cart-button");u&&u.addEventListener("click",()=>{const a=ph_checkout_params==null?void 0:ph_checkout_params.order_id,d=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!a||!d)return;const c='<span class="ph-notification-spinner" style="border-top-color: #fff;"></span>',l=p({message:`${c} Restaurando seu carrinho...`,type:"info",duration:0});jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_restore_cart",security:d,order_id:a},function(m){m.success?(l&&(l.innerHTML=`${c} Redirecionando você para a tela de checkout...`),setTimeout(()=>{window.location.href=m.data.redirect_url},2e3)):(l&&l.remove(),p({message:"Ocorreu um erro ao tentar restaurar seu carrinho. Por favor, tente novamente.",type:"error"}))})})});let f=!1;function g(e){return new Promise(t=>setTimeout(t,e))}async function v(e,t,n,o,i,r){let s=0;const u=async()=>{if(!document.body.contains(e)||(await g(o),!document.body.contains(e)))return;const a=n[s];for(let c=a.length;c>=0;c--){if(!document.body.contains(e))return;t.textContent=a.substring(0,c),await g(i/a.length)}s=(s+1)%n.length;const d=n[s];for(let c=0;c<d.length;c++){if(!document.body.contains(e))return;t.textContent+=d[c],await g(r/d.length)}u()};u()}const T=()=>{if(f)return;f=!0;const e=document.getElementById("ph-i-paid-button");e&&(e.disabled=!0);const t=ph_checkout_params==null?void 0:ph_checkout_params.order_id,n=ph_checkout_params==null?void 0:ph_checkout_params.nonce;if(!t||!n){f=!1,e&&(e.disabled=!1);return}const o='<span class="ph-notification-spinner"></span>',i=["Estamos confirmando seu pagamento, só um instante...","Às vezes o banco leva um tempinho para nos notificar.","Não se preocupe, vamos continuar verificando por aqui."],r=p({message:`${o} <span>${i[0]}</span>`,type:"warning",duration:0}),s=r.querySelector("span:last-child");v(r,s,i,6e3,250,1e3);const u=()=>{jQuery.post(ph_checkout_params.ajax_url,{action:"paghiper_check_payment_status",security:n,order_id:t},function(c){c.success&&c.data.status==="paid"&&(clearInterval(a),clearTimeout(d),r.remove(),p({message:"Pagamento confirmado!",type:"success"}),setTimeout(()=>{typeof h=="function"?h():window.location.reload()},1e3))})},a=setInterval(u,15e3),d=setTimeout(()=>{clearInterval(a),r.remove(),p({message:"Ainda não recebemos a confirmação do seu pagamento.",type:"error"}),f=!1,e&&(e.disabled=!1)},18e5);u()};
})();