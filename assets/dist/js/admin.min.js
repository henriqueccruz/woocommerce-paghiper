(function(){var j=Object.defineProperty;var z=(e,c,u)=>c in e?j(e,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[c]=u;var E=(e,c,u)=>z(e,typeof c!="symbol"?c+"":c,u);jQuery(function(e){function c(n){const{message:t,type:i="info",duration:s=3e3}=n;e("#ph-reusable-notifications").length||e("body").append('<div id="ph-reusable-notifications"></div>');const d=e("<div></div>").addClass(`ph-notification ${i}`).html(t);return e("#ph-reusable-notifications").append(d),s>0&&setTimeout(()=>{d.addClass("fade-out"),d.on("animationend",()=>{d.remove()})},s),d}if(typeof paghiper_settings>"u"||!e("#paghiper-due-date-container").length)return;const x=e("#woocommerce_paghiper_pix_due_date_mode, #woocommerce_paghiper_billet_due_date_mode"),g=e("#woocommerce_paghiper_pix_due_date_value, #woocommerce_paghiper_billet_due_date_value"),M=e("#woocommerce_paghiper_pix_api_key, #woocommerce_paghiper_billet_api_key"),k=e("#copy-credentials, #test-credentials");M.length&&k.length&&k.insertAfter(M);const b=e("#due-date-mode-toggle"),_=e("#days-mode-section"),S=e("#minutes-mode-section");e(".mode-switcher.disabled").on("click",function(n){n.preventDefault(),c({message:"Essa opção está disponível apenas para o PIX PagHiper.",type:"info"})}),paghiper_settings.is_pix?b.on("change",function(){const n=e(this).is(":checked");_.toggleClass("active",!n),S.toggleClass("active",n),x.val(n?"minutes":"days").trigger("change"),m()}):(_.addClass("active"),S.removeClass("active"),x.val("days")),e("#mainform").on("submit",function(n){if(paghiper_settings.is_pix&&x.val()==="minutes"){const t=g.val();t<5&&(confirm(`A(s) transação(ões) gerada(s) vai(vão) expirar em apenas ${t} minutos. Continuar?`)||n.preventDefault())}});let l={},v;function m(){if(paghiper_settings.is_pix&&b.is(":checked")){const n=l.days.value,t=l.hours.value,i=l.minutes.value,s=n*24*60+t*60+i;g.val(s).trigger("change")}else g.val(v.value).trigger("change")}class D{constructor(t){this.element=e('<div class="odometer-digit"></div>'),this.currentValue=parseInt(t,10),this.rotor=e('<div class="odometer-rotor"></div>');for(let i=0;i<10;i++)this.rotor.append(e('<div class="odometer-digit-value"></div>').text(i));this.rotor.append(e('<div class="odometer-digit-value"></div>').text(0)),this.element.append(this.rotor)}initializePosition(){const t=this.element.height();t!==0&&this.rotor.css({transition:"none",transform:`translateY(-${this.currentValue*t}px)`})}setValue(t,i){if(t===this.currentValue)return;const s=this.element.height();if(s===0)return;const a=this.rotor,d=this.currentValue===9&&t===0&&i>0,o=this.currentValue===0&&t===9&&i<0;d?(a.css({transition:"transform 0.4s ease-in-out",transform:`translateY(-${10*s}px)`}),setTimeout(()=>{a.css({transition:"none",transform:"translateY(0px)"})},400)):o?(a.css({transition:"none",transform:`translateY(-${10*s}px)`}),setTimeout(()=>{a.css({transition:"transform 0.4s ease-in-out",transform:`translateY(-${9*s}px)`})},20)):a.css({transition:"transform 0.4s ease-in-out",transform:`translateY(-${t*s}px)`}),this.currentValue=t}}const w=class w{constructor(t,i,s){this.container=e(t),this.config=w.LIMITS[s],this.value=Math.max(this.config.min,Math.min(i,this.config.max)),this.digits=[],this.isEditing=!1,this.wrapper=e('<div class="odometer-display"></div>'),this.container.html(this.wrapper);const a=this.value>=100?3:2,d=this.value.toString().padStart(a,"0");for(let o=0;o<d.length;o++){const r=new D(d[o]);this.digits.push(r),this.wrapper.append(r.element),r.initializePosition()}this.digits.length===3?this.wrapper.addClass("has-three-digits"):this.wrapper.removeClass("has-three-digits"),this.wrapper.on("click",()=>{this.isEditing||this.showInput()})}showInput(){let t=this.wrapper.outerWidth(),i=this.wrapper.outerHeight();console.log(t,i),this.isEditing=!0,this.wrapper.hide();const s=e('<input type="number" class="odometer-input" />');s.css({"min-width":t+"px",width:t+"px",height:i+"px","font-size":"1.8em","text-align":"center",border:"1px solid #999","background-color":"#fff","box-sizing":"border-box",margin:0,padding:0}),s.val(this.value),this.container.append(s),s.focus().select();const a=e('<span style="display:none"></span>');a.css({"font-size":s.css("font-size"),"font-family":s.css("font-family")}),e("body").append(a),s.on("input",function(){a.text(e(this).val()),e(this).css("width",a.width()+10+"px")}).trigger("input");const d=()=>{let o=parseInt(s.val(),10);if(isNaN(o)?o=this.value:o=Math.max(this.config.min,Math.min(o,this.config.max)),s.remove(),this.wrapper.show(),this.isEditing=!1,o!==this.value){const r=o>this.value?1:-1;this.setValue(o,r),m()}};s.on("blur",d),s.on("keydown",o=>{o.key==="Enter"?d():o.key==="Escape"&&(s.remove(),this.wrapper.show(),this.isEditing=!1)})}setValue(t,i){if(t===this.value)return;const s=t>=100?3:2,a=this.value.toString(),d=t.toString(),o=this.digits.length,r=Math.max(s,d.length);if(r>o)for(let p=o;p<r;p++){const f=new D("0");this.digits.unshift(f),this.wrapper.prepend(f.element),f.initializePosition()}else if(r<o)for(let p=r;p<o;p++)this.digits[0].element.remove(),this.digits.shift();r===3?this.wrapper.addClass("has-three-digits"):this.wrapper.removeClass("has-three-digits");const y=a.padStart(this.digits.length,"0"),V=d.padStart(this.digits.length,"0");for(let p=0;p<this.digits.length;p++){const f=parseInt(y[p],10),I=parseInt(V[p],10);f!==I&&this.digits[p].setValue(I,i)}this.value=t}increment(){let t=!1,i=this.value+1;return i>this.config.max&&(i=this.config.wrap?this.config.min:this.config.max,t=!0),this.setValue(i,1),t}decrement(){let t=!1,i=this.value-1;return i<this.config.min&&(i=this.config.max,t=!0),this.setValue(i,-1),t}};E(w,"LIMITS",{"boleto-days":{min:1,max:400,wrap:!0},"pix-days":{min:0,max:400,wrap:!0},hours:{min:0,max:23,wrap:!0},minutes:{min:0,max:59,wrap:!0}});let h=w;const P=paghiper_settings.due_date_mode==="days"?parseInt(paghiper_settings.due_date_value,10):1,C=paghiper_settings.is_pix?"pix-days":"boleto-days";if(v=new h(_.find(".days-display"),P,C),_.find(".chevron-control").on("click",function(){if(e(".odometer-input").length){e(".odometer-input").trigger("blur");return}e(this).data("action")==="increment"?v.increment():v.decrement(),m()}),paghiper_settings.is_pix){let n=function(){let t={days:0,hours:0,minutes:30};if(paghiper_settings.due_date_mode==="minutes"){const i=parseInt(paghiper_settings.due_date_value,10);!isNaN(i)&&i>0&&(t={days:Math.floor(i/(24*60)),hours:Math.floor(i%(24*60)/60),minutes:i%60})}l.days=new h(e("#cron-days-pix"),t.days,"pix-days"),l.hours=new h(e("#cron-hours-pix"),t.hours,"hours"),l.minutes=new h(e("#cron-minutes-pix"),t.minutes,"minutes"),m()};var B=n;n(),e("#minutes-mode-section .chevron-control").on("click",function(){if(e(".odometer-input").length){e(".odometer-input").trigger("blur");return}const t=e(this),i=t.data("unit");t.data("action")==="increment"?l[i].increment()&&(i==="minutes"?l.hours.increment()&&l.days.increment():i==="hours"&&l.days.increment()):l[i].decrement()&&(i==="minutes"?l.hours.decrement()&&l.days.decrement():i==="hours"&&l.days.decrement()),m()}),b.trigger("change")}e("#copy-credentials").on("click",function(){let n=null;n=c({message:'<span class="ph-notification-spinner"></span> Copiando credenciais...',type:"info",duration:0}),e.post(ajaxurl,{action:"paghiper_copy_credentials",nonce:paghiper_settings.nonce,to:paghiper_settings.gateway_id},function(i){i.success?(c({message:"Credenciais configuradas com sucesso!",type:"success",duration:5e3}),setTimeout(()=>{location.reload()},1e3)):c({message:i.data.message,type:"error"}),n&&n.remove()})}),e("#test-credentials").on("click",function(){const n=e("#woocommerce_paghiper_pix_api_key, #woocommerce_paghiper_billet_api_key").val(),t=e("#woocommerce_paghiper_pix_token, #woocommerce_paghiper_billet_token").val();let i=null;i=c({message:'<span class="ph-notification-spinner"></span> Testando credenciais...',type:"info",duration:0}),e.post(ajaxurl,{action:"paghiper_test_credentials",nonce:paghiper_settings.nonce,apiKey:n,token:t},function(a){a.success?c({message:a.data.message,type:"success"}):c({message:a.data.message,type:"error"}),i&&i.remove()}).fail(function(a,d,o){a.status===500?c({message:"Servidor indisponível (erro 500)",type:"error"}):c({message:"Não foi possível checar suas credenciais agora.",type:"error"}),i&&i.remove()})});const T={form:e("form#mainform"),modal:e("#paghiper-downloader-modal"),progressBar:e("#paghiper-downloader-modal .paghiper-progress"),statusMessage:e("#paghiper-downloader-modal .paghiper-status-message"),initialMessage:e("#paghiper-downloader-modal .paghiper-modal-initial-message"),isDownloading:!1,init:function(){this.form.on("submit",this.handleSubmit.bind(this))},openModal:function(){this.modal.dialog({modal:!0,width:500,closeOnEscape:!1,draggable:!1,resizable:!1,open:function(n,t){e(this).parent().find(".ui-dialog-titlebar-close").hide()}})},closeModal:function(){this.modal.is(":ui-dialog")&&this.modal.dialog("close")},updateProgress:function(n,t){this.progressBar.css("width",n+"%").text(Math.round(n)+"%"),this.statusMessage.text(t)},showError:function(n){this.isDownloading=!1,this.initialMessage.hide(),this.progressBar.css("background-color","#dc3232"),this.updateProgress(100,"Erro!"),this.statusMessage.html(n+'<br/><br/><button class="button button-primary" id="close-downloader-modal">Fechar</button>'),e("#close-downloader-modal").on("click",this.closeModal.bind(this))},downloadBundle:function(n){return e.post(ajaxurl,{action:"paghiper_download_timer_assets",nonce:paghiper_settings.nonce,bundle:n})},downloadSequentially:function(n){const t=e.Deferred(),i=n.length;let s=0;const a=()=>{if(s>=i){t.resolve();return}const d=n[s],o=(s+1)/i*100;this.updateProgress(o,`Baixando pacote ${s+1} de ${i}...`),this.downloadBundle(d).done(r=>{if(r.success)s++,a();else{const y=r.data&&r.data.message?r.data.message:"Ocorreu um erro no servidor.";this.showError(y),t.reject()}}).fail(r=>{this.showError("Falha de comunicação com o servidor. Verifique sua conexão e os logs de erro do PHP."),t.reject()})};return a(),t.promise()},handleSubmit:function(n){if(this.isDownloading){n.preventDefault();return}const t=paghiper_settings.gateway_id==="paghiper_pix",i=e("#due-date-mode-toggle").is(":checked"),s=e("#woocommerce_paghiper_pix_disable_email_gif").is(":checked");if(!t||!i||s||this.form.find("#paghiper_assets_checked").length>0)return;n.preventDefault(),this.isDownloading=!0,this.openModal(),this.modal.find("#paghiper-progress").css("background-color","#4CAF50"),this.modal.find("#paghiper-modal-initial-message").show(),this.updateProgress(0,"");const a=parseInt(g.val(),10)||0,d=Math.ceil(a/60);this.updateProgress(0,"Verificando pacotes necessários..."),e.post(ajaxurl,{action:"paghiper_get_timer_asset_status",nonce:paghiper_settings.nonce,bundles_needed:d}).done(o=>{if(!o.success){this.showError(o.data.message);return}const r=o.data.missing_bundles;if(r.length===0){this.updateProgress(100,"Recursos já estão instalados e verificados!"),setTimeout(()=>{this.isDownloading=!1,this.closeModal(),this.form.append('<input type="hidden" id="paghiper_assets_checked" name="paghiper_assets_checked" value="1">'),console.log("Submitting with due_date_value:",g.val()),this.form.find('button[name="save"]').click()},1500);return}this.downloadSequentially(r).done(()=>{this.progressBar.css("background-color","#4CAF50"),this.updateProgress(100,"Todos os pacotes foram instalados com sucesso!"),setTimeout(()=>{this.isDownloading=!1,this.closeModal(),this.form.append('<input type="hidden" id="paghiper_assets_checked" name="paghiper_assets_checked" value="1">'),this.form.find('button[name="save"]').click()},1500)}).fail(()=>{console.log("Download sequence failed and was caught.")})}).fail(o=>{const r="Falha na comunicação com o servidor ao verificar o status dos pacotes. (Status: "+o.status+" "+o.statusText+"). Verifique os logs do servidor para mais detalhes.";this.showError(r)})}};typeof paghiper_settings<"u"&&paghiper_settings.gateway_id==="paghiper_pix"&&T.init()});
//# sourceMappingURL=admin.min.js.map
})();